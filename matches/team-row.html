<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AL-AMEED TV | Ø§Ù„ÙØ±ÙŠÙ‚</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-deep: #050810;
        --bg-surface: #0c1120;
        --bg-card: #111827;
        --bg-card-hover: #162036;
        --accent: #00e676;
        --accent-glow: #00e67633;
        --live: #ff3d57;
        --live-glow: #ff3d5733;
        --gold: #ffd54f;
        --gold-glow: #ffd54f22;
        --text-primary: #f0f4ff;
        --text-secondary: #8899bb;
        --text-muted: #3a4f70;
        --border: #1a2840;
        --border-light: #263850;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Tajawal", sans-serif;
        background: var(--bg-deep);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background:
          radial-gradient(
            ellipse 90% 60% at 50% -10%,
            #0a2040 0%,
            transparent 60%
          ),
          radial-gradient(
            ellipse 50% 50% at 90% 90%,
            #001830 0%,
            transparent 60%
          );
        pointer-events: none;
        z-index: 0;
      }

      /* â”€â”€ HEADER â”€â”€ */
      .header {
        position: sticky;
        top: 0;
        z-index: 200;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        height: 60px;
        background: rgba(5, 8, 16, 0.92);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
      }
      .logo {
        font-family: "Bebas Neue", sans-serif;
        font-size: 24px;
        letter-spacing: 3px;
        color: var(--accent);
        text-decoration: none;
        text-shadow: 0 0 24px var(--accent-glow);
      }
      .header-nav {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .header-nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
        padding: 6px 14px;
        border-radius: 8px;
        transition: all 0.2s;
      }
      .header-nav a:hover {
        color: var(--text-primary);
        background: var(--border);
      }
      .back-btn {
        display: flex;
        align-items: center;
        gap: 5px;
        border: 1px solid var(--border);
        border-radius: 8px;
        transition: border-color 0.2s;
      }
      .back-btn:hover {
        border-color: var(--border-light) !important;
      }

      /* â”€â”€ TEAM IDENTITY CARD â”€â”€ */
      .team-hero {
        position: relative;
        z-index: 1;
        max-width: 900px;
        margin: 28px auto 0;
        padding: 0 16px;
        animation: fadeUp 0.45s ease forwards;
      }

      .team-identity {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 28px 28px 22px;
        position: relative;
        overflow: hidden;
      }
      .team-identity::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          ellipse 80% 70% at 50% 0%,
          rgba(0, 230, 118, 0.05),
          transparent 65%
        );
        pointer-events: none;
      }

      .team-identity-inner {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .team-logo-large-wrap {
        flex-shrink: 0;
        position: relative;
      }
      .team-logo-large {
        width: 80px;
        height: 80px;
        object-fit: contain;
        border-radius: 50%;
        background: var(--bg-surface);
        padding: 8px;
        border: 2px solid var(--border);
      }
      .team-logo-placeholder {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--bg-surface);
        border: 2px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
      }

      .team-info {
        flex: 1;
        min-width: 0;
      }
      .team-name-large {
        font-family: "Bebas Neue", sans-serif;
        font-size: clamp(26px, 5vw, 40px);
        letter-spacing: 2px;
        color: var(--text-primary);
        line-height: 1;
        margin-bottom: 6px;
      }
      .team-sub {
        font-size: 13px;
        color: var(--text-secondary);
      }

      /* stats row */
      .team-stats {
        display: flex;
        gap: 0;
        margin-top: 20px;
        border-top: 1px solid var(--border);
        padding-top: 16px;
      }
      .stat-item {
        flex: 1;
        text-align: center;
        padding: 0 8px;
        border-left: 1px solid var(--border);
      }
      .stat-item:last-child {
        border-left: none;
      }
      .stat-val {
        font-family: "Bebas Neue", sans-serif;
        font-size: 26px;
        letter-spacing: 1px;
        color: var(--text-primary);
        line-height: 1;
      }
      .stat-val.win {
        color: var(--accent);
      }
      .stat-val.draw {
        color: var(--gold);
      }
      .stat-val.loss {
        color: var(--live);
      }
      .stat-label {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-muted);
        letter-spacing: 0.5px;
        margin-top: 3px;
        white-space: nowrap;
      }

      /* â”€â”€ DATE NAVIGATOR â”€â”€ */
      .date-nav {
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        padding: 20px 12px 16px;
        max-width: 900px;
        margin: 0 auto;
      }
      .date-arrow {
        flex-shrink: 0;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 50%;
        cursor: pointer;
        color: var(--text-secondary);
        font-size: 18px;
        transition: all 0.2s;
        user-select: none;
      }
      .date-arrow:hover {
        border-color: var(--accent);
        color: var(--accent);
        box-shadow: 0 0 10px var(--accent-glow);
      }
      .date-arrow:active {
        transform: scale(0.9);
      }
      .date-strip-wrap {
        flex: 1;
        overflow: hidden;
        position: relative;
        margin: 0 8px;
      }
      .date-strip-wrap::before,
      .date-strip-wrap::after {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        width: 28px;
        z-index: 2;
        pointer-events: none;
      }
      .date-strip-wrap::before {
        right: 0;
        background: linear-gradient(to left, var(--bg-deep), transparent);
      }
      .date-strip-wrap::after {
        left: 0;
        background: linear-gradient(to right, var(--bg-deep), transparent);
      }
      .date-strip {
        display: flex;
        gap: 6px;
        overflow-x: auto;
        scroll-behavior: smooth;
        padding: 4px 6px;
        scrollbar-width: none;
      }
      .date-strip::-webkit-scrollbar {
        display: none;
      }
      .date-pill {
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 8px 14px;
        border-radius: 50px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        cursor: pointer;
        transition: all 0.2s;
        min-width: 64px;
      }
      .date-pill:hover {
        border-color: var(--border-light);
        transform: translateY(-1px);
      }
      .date-pill .pill-label {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-muted);
        letter-spacing: 0.5px;
        line-height: 1;
        margin-bottom: 2px;
      }
      .date-pill .pill-day {
        font-family: "Bebas Neue", sans-serif;
        font-size: 18px;
        color: var(--text-secondary);
        letter-spacing: 1px;
        line-height: 1;
      }
      .date-pill.active {
        background: var(--accent);
        border-color: var(--accent);
        box-shadow:
          0 0 16px var(--accent-glow),
          0 4px 12px rgba(0, 230, 118, 0.25);
      }
      .date-pill.active .pill-label,
      .date-pill.active .pill-day {
        color: #000;
      }
      .date-pill.is-today .pill-label {
        color: var(--accent);
      }
      .date-pill.is-today:not(.active) .pill-day {
        color: var(--text-primary);
      }
      .date-pill.has-match::after {
        content: "";
        display: block;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: var(--accent);
        margin-top: 3px;
        opacity: 0.7;
      }
      .date-pill.has-live::after {
        background: var(--live);
        animation: dotPulse 1.2s ease infinite;
      }

      /* â”€â”€ FILTER ROW â”€â”€ */
      .filter-row {
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 900px;
        margin: 0 auto 16px;
        padding: 0 16px;
        gap: 10px;
      }
      .filter-label {
        font-size: 12px;
        font-weight: 700;
        color: var(--text-muted);
        letter-spacing: 1px;
        text-transform: uppercase;
      }
      .show-all-btn {
        background: none;
        border: 1px solid var(--border);
        color: var(--text-secondary);
        font-family: "Tajawal", sans-serif;
        font-size: 12px;
        font-weight: 600;
        padding: 5px 14px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .show-all-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }
      .show-all-btn.active {
        background: var(--accent);
        color: #000;
        border-color: var(--accent);
      }

      /* â”€â”€ MATCHES WRAPPER â”€â”€ */
      .matches-wrapper {
        position: relative;
        z-index: 1;
        max-width: 900px;
        margin: 0 auto;
        padding: 0 14px 80px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      /* â”€â”€ MATCH CARD â”€â”€ (identical to matches.html) */
      .match-card {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        gap: 10px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 15px 18px;
        text-decoration: none;
        color: inherit;
        transition: all 0.22s ease;
        position: relative;
        overflow: hidden;
        animation: fadeUp 0.3s ease forwards;
        opacity: 0;
      }
      .match-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          transparent 55%,
          rgba(0, 230, 118, 0.02)
        );
        pointer-events: none;
      }
      .match-card:hover {
        background: var(--bg-card-hover);
        border-color: var(--border-light);
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(0, 0, 0, 0.4);
      }
      .match-card.is-live {
        border-color: #ff3d5766;
        box-shadow:
          inset 0 0 30px rgba(255, 61, 87, 0.04),
          0 0 0 1px rgba(255, 61, 87, 0.15);
      }
      /* highlight the team we're viewing */
      .match-card .team-side.highlight .team-name {
        color: var(--accent);
      }
      .match-card.hidden {
        display: none;
      }

      .team-side {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .team-side.right {
        flex-direction: row-reverse;
      }

      .team-logo {
        width: 38px;
        height: 38px;
        object-fit: contain;
        border-radius: 50%;
        background: var(--bg-surface);
        padding: 4px;
        flex-shrink: 0;
      }
      .team-name {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        line-height: 1.2;
      }
      .team-side.right .team-name {
        text-align: right;
      }

      .match-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        min-width: 88px;
      }
      .score-display {
        font-family: "Bebas Neue", sans-serif;
        font-size: 30px;
        letter-spacing: 4px;
        color: var(--text-primary);
        line-height: 1;
      }
      .vs-display {
        font-size: 18px;
        font-weight: 800;
        color: var(--text-muted);
        letter-spacing: 2px;
      }
      .status-badge {
        font-size: 11px;
        font-weight: 700;
        padding: 2px 10px;
        border-radius: 20px;
        background: var(--bg-surface);
        color: var(--text-muted);
        border: 1px solid var(--border);
        white-space: nowrap;
      }
      .status-badge.live {
        background: var(--live-glow);
        color: var(--live);
        border-color: var(--live);
        animation: pulseBadge 1.5s ease infinite;
      }
      @keyframes pulseBadge {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(255, 61, 87, 0.3);
        }
        50% {
          box-shadow: 0 0 0 4px rgba(255, 61, 87, 0);
        }
      }
      .match-time {
        font-size: 11px;
        color: var(--text-muted);
        direction: ltr;
      }
      .comp-name {
        font-size: 10px;
        color: var(--text-muted);
        max-width: 90px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: center;
        text-decoration: none;
        display: block;
      }
      .comp-name:hover {
        color: var(--text-secondary);
      }
      .aggregate-text,
      .win-description {
        font-size: 11px;
        color: var(--gold);
        font-weight: 600;
        text-align: center;
      }
      .live-dot {
        display: inline-block;
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: var(--live);
        margin-left: 3px;
        vertical-align: middle;
        animation: dotPulse 1.2s ease infinite;
      }
      @keyframes dotPulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.4;
          transform: scale(0.7);
        }
      }

      /* RESULT INDICATOR on card left edge */
      .match-card.result-w {
        border-right: 3px solid var(--accent);
      }
      .match-card.result-d {
        border-right: 3px solid var(--gold);
      }
      .match-card.result-l {
        border-right: 3px solid var(--live);
      }

      /* â”€â”€ STATES â”€â”€ */
      .loading-state {
        position: relative;
        z-index: 1;
        text-align: center;
        padding: 80px 20px;
      }
      .spinner {
        width: 44px;
        height: 44px;
        border: 3px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        margin: 0 auto 16px;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .loading-state p {
        color: var(--text-muted);
        font-size: 14px;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
        display: none;
        position: relative;
        z-index: 1;
      }
      .empty-state .icon {
        font-size: 44px;
        margin-bottom: 14px;
      }
      .empty-state p {
        font-size: 14px;
      }

      .error-box {
        text-align: center;
        padding: 48px 20px;
        color: var(--live);
        font-size: 14px;
        position: relative;
        z-index: 1;
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      ::-webkit-scrollbar {
        width: 5px;
        height: 5px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }

      @media (max-width: 480px) {
        .team-logo-large {
          width: 60px;
          height: 60px;
        }
        .team-logo-placeholder {
          width: 60px;
          height: 60px;
        }
        .match-card {
          padding: 12px 10px;
          gap: 7px;
        }
        .score-display {
          font-size: 24px;
        }
        .team-name {
          font-size: 12px;
        }
        .team-logo {
          width: 30px;
          height: 30px;
        }
        .match-center {
          min-width: 70px;
        }
        .date-pill {
          min-width: 54px;
          padding: 7px 10px;
        }
        .date-pill .pill-day {
          font-size: 15px;
        }
        .team-identity-inner {
          gap: 14px;
        }
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <div class="header">
      <a class="logo">ALAMEED</a>
      <div class="header-nav">
        <a class="back-btn" href="matches.html">&#8249; Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</a>
        <a href="../index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>
    </div>

    <!-- TEAM HERO (injected by JS) -->
    <div id="teamHero"></div>

    <!-- DATE NAVIGATOR -->
    <div class="date-nav">
      <div class="date-arrow" onclick="shiftDate(-1)">&#8250;</div>
      <div class="date-strip-wrap">
        <div class="date-strip" id="dateStrip"></div>
      </div>
      <div class="date-arrow" onclick="shiftDate(1)">&#8249;</div>
    </div>

    <!-- FILTER ROW -->
    <div class="filter-row">
      <span class="filter-label" id="filterLabel">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</span>
      <button class="show-all-btn" id="showAllBtn" onclick="toggleShowAll()">
        Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
      </button>
    </div>

    <!-- LOADING -->
    <div class="loading-state" id="loadingState">
      <div class="spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙØ±ÙŠÙ‚...</p>
    </div>

    <!-- MATCHES -->
    <div class="matches-wrapper" id="matchesContainer"></div>

    <!-- EMPTY -->
    <div class="empty-state" id="emptyState">
      <div class="icon">ğŸŸï¸</div>
      <p id="emptyMsg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p>
    </div>

    <script>
      /* â•â•â• HELPERS â•â•â• */
      function getQueryParam(p) {
        return new URLSearchParams(window.location.search).get(p);
      }
      function todayStr() {
        return new Date().toISOString().split("T")[0];
      }
      function dateOffset(base, days) {
        const d = new Date(base + "T12:00:00");
        d.setDate(d.getDate() + days);
        return d.toISOString().split("T")[0];
      }
      function isLive(s) {
        return (
          s &&
          (s.includes("Ø´ÙˆØ·") ||
            s.includes("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ") ||
            s.includes("Ø¨Ø¯Ù„Ø§Ø¡"))
        );
      }
      function isFinished(s) {
        return s && (s.includes("Ø§Ù†ØªÙ‡Øª") || s.includes("Ù†Ù‡Ø§ÙŠØ©"));
      }

      /* â•â•â• DATE NAV STATE â•â•â• */
      let selectedDate = todayStr();
      let showAll = false;
      const RANGE = 7;
      let allGames = [];
      let currentTeamId = null;

      function buildDateStrip() {
        const strip = document.getElementById("dateStrip");
        strip.innerHTML = "";
        const today = todayStr();

        // collect dates that have matches
        const matchDates = new Set(allGames.map((g) => g.startyear));
        const liveDates = new Set(
          allGames.filter((g) => isLive(g.statusText)).map((g) => g.startyear),
        );

        for (let i = -RANGE; i <= RANGE; i++) {
          const ds = dateOffset(today, i);
          const d = new Date(ds + "T12:00:00");
          const pill = document.createElement("div");

          pill.className =
            "date-pill" +
            (ds === today ? " is-today" : "") +
            (ds === selectedDate ? " active" : "") +
            (liveDates.has(ds)
              ? " has-live"
              : matchDates.has(ds)
                ? " has-match"
                : "");

          pill.dataset.date = ds;

          let label = "";
          if (i === -1) label = "Ø£Ù…Ø³";
          else if (i === 0) label = "Ø§Ù„ÙŠÙˆÙ…";
          else if (i === 1) label = "ØºØ¯Ø§Ù‹";
          else label = d.toLocaleDateString("ar-SA", { weekday: "short" });

          pill.innerHTML = `<span class="pill-label">${label}</span><span class="pill-day">${d.getDate()}</span>`;
          pill.onclick = () => {
            showAll = false;
            document.getElementById("showAllBtn").classList.remove("active");
            selectDate(ds);
          };
          strip.appendChild(pill);
        }
        scrollActivePillIntoView();
      }

      function scrollActivePillIntoView() {
        setTimeout(() => {
          const el = document.querySelector(".date-pill.active");
          if (el)
            el.scrollIntoView({
              inline: "center",
              behavior: "smooth",
              block: "nearest",
            });
        }, 60);
      }

      function selectDate(ds) {
        selectedDate = ds;
        document
          .querySelectorAll(".date-pill")
          .forEach((p) => p.classList.toggle("active", p.dataset.date === ds));
        applyFilter();
      }

      function shiftDate(delta) {
        const today = todayStr();
        const newDs = dateOffset(selectedDate, delta);
        const min = dateOffset(today, -RANGE);
        const max = dateOffset(today, RANGE);
        selectedDate = newDs < min ? min : newDs > max ? max : newDs;
        showAll = false;
        document.getElementById("showAllBtn").classList.remove("active");
        buildDateStrip();
        applyFilter();
      }

      function toggleShowAll() {
        showAll = !showAll;
        document
          .getElementById("showAllBtn")
          .classList.toggle("active", showAll);
        applyFilter();
      }

      /* â•â•â• STATS from loaded games â•â•â• */
      function computeStats(games, teamId) {
        let w = 0,
          d = 0,
          l = 0,
          played = 0;
        games.forEach((g) => {
          if (!isFinished(g.statusText)) return;
          played++;
          const isHome = g.first_team_id === teamId;
          const gs =
            parseInt(isHome ? g.first_team_score : g.second_team_score) || 0;
          const opp =
            parseInt(isHome ? g.second_team_score : g.first_team_score) || 0;
          if (gs > opp) w++;
          else if (gs === opp) d++;
          else l++;
        });
        return { w, d, l, played };
      }

      /* â•â•â• TEAM HERO â•â•â• */
      function renderTeamHero(games, teamId) {
        // Derive team info from first game containing this team
        let teamName = "",
          teamLogo = "";
        for (const g of games) {
          if (g.first_team_id === teamId) {
            teamName = g.first_team;
            teamLogo = g.first_team_logo;
            break;
          }
          if (g.second_team_id === teamId) {
            teamName = g.second_team;
            teamLogo = g.second_team_logo;
            break;
          }
        }

        const stats = computeStats(games, teamId);
        const logoEl = teamLogo
          ? `<img class="team-logo-large" src="${teamLogo}" alt="${teamName}" onerror="this.style.visibility='hidden'">`
          : `<div class="team-logo-placeholder">ğŸŸï¸</div>`;

        document.getElementById("teamHero").innerHTML = `
        <div class="team-hero">
            <div class="team-identity">
                <div class="team-identity-inner">
                    <div class="team-logo-large-wrap">${logoEl}</div>
                    <div class="team-info">
                        <div class="team-name-large">${teamName || "Ø§Ù„ÙØ±ÙŠÙ‚"}</div>
                        <div class="team-sub">Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙØ±ÙŠÙ‚ Â· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</div>
                    </div>
                </div>
                ${
                  stats.played > 0
                    ? `
                <div class="team-stats">
                    <div class="stat-item">
                        <div class="stat-val">${stats.played}</div>
                        <div class="stat-label">Ù„ÙØ¹Ø¨Øª</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-val win">${stats.w}</div>
                        <div class="stat-label">ÙÙˆØ²</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-val draw">${stats.d}</div>
                        <div class="stat-label">ØªØ¹Ø§Ø¯Ù„</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-val loss">${stats.l}</div>
                        <div class="stat-label">Ø®Ø³Ø§Ø±Ø©</div>
                    </div>
                </div>`
                    : ""
                }
            </div>
        </div>
    `;

        // also update page title
        if (teamName) document.title = `${teamName} | ALAMEED TV`;
      }

      /* â•â•â• MATCH CARD â•â•â• */
      function buildCard(g, teamId, idx) {
        const card = document.createElement("a");
        card.className = "match-card";
        card.href = `game-details.html?gameid=${g.id}`;
        card.dataset.id = g.id;
        card.dataset.date = g.startyear;
        card.style.animationDelay = idx * 35 + "ms";

        if (isLive(g.statusText)) card.classList.add("is-live");

        // result colour stripe
        if (isFinished(g.statusText)) {
          const isHome = g.first_team_id === teamId;
          const gs =
            parseInt(isHome ? g.first_team_score : g.second_team_score) || 0;
          const opp =
            parseInt(isHome ? g.second_team_score : g.first_team_score) || 0;
          if (gs > opp) card.classList.add("result-w");
          else if (gs === opp) card.classList.add("result-d");
          else card.classList.add("result-l");
        }

        const isHomeTeam = g.first_team_id === teamId;
        const isAwayTeam = g.second_team_id === teamId;

        const gt = g.gameTime ? ` ${g.gameTime}'` : "";
        const dot = isLive(g.statusText)
          ? '<span class="live-dot"></span>'
          : "";
        const score =
          g.statusText === "Ù„Ù… ØªØ¨Ø¯Ø£"
            ? `<div class="vs-display">VS</div>`
            : `<div class="score-display">${g.first_team_score} - ${g.second_team_score}</div>`;
        const agg = g.aggregateText
          ? `<div class="aggregate-text">${g.aggregateText}</div>`
          : "";
        const win = g.winDescription
          ? `<div class="win-description">${g.winDescription}</div>`
          : "";

        card.innerHTML = `
        <div class="team-side right ${isHomeTeam ? "highlight" : ""}">
            <div class="team-name">${g.first_team}</div>
            <a href="team-row.html?teamid=${g.first_team_id}" onclick="event.stopPropagation()">
                <img class="team-logo" src="${g.first_team_logo}" alt="${g.first_team}" onerror="this.style.display='none'">
            </a>
        </div>

        <div class="match-center">
            ${score}
            <span class="status-badge ${isLive(g.statusText) ? "live" : ""}">${dot}${g.statusText}${gt}</span>
            <span class="match-time">${g.startTime} â€¢ ${g.startyear}</span>
            ${agg}${win}
            <a class="comp-name" href="league-games.html?league=${g.competitionId}" onclick="event.stopPropagation()">${g.competitionDisplayName}</a>
        </div>

        <div class="team-side left ${isAwayTeam ? "highlight" : ""}">
            <a href="team-row.html?teamid=${g.second_team_id}" onclick="event.stopPropagation()">
                <img class="team-logo" src="${g.second_team_logo}" alt="${g.second_team}" onerror="this.style.display='none'">
            </a>
            <div class="team-name">${g.second_team}</div>
        </div>
    `;
        return card;
      }

      function updateCard(card, g) {
        const scoreEl = card.querySelector(".score-display, .vs-display");
        if (g.statusText === "Ù„Ù… ØªØ¨Ø¯Ø£") {
          if (scoreEl) {
            scoreEl.className = "vs-display";
            scoreEl.textContent = "VS";
          }
        } else {
          const ns = `${g.first_team_score} - ${g.second_team_score}`;
          if (scoreEl) {
            scoreEl.className = "score-display";
            if (scoreEl.textContent !== ns) scoreEl.textContent = ns;
          }
        }
        const st = card.querySelector(".status-badge");
        if (st) {
          const gt = g.gameTime ? ` ${g.gameTime}'` : "";
          const dot = isLive(g.statusText)
            ? '<span class="live-dot"></span>'
            : "";
          st.innerHTML = `${dot}${g.statusText}${gt}`;
          st.className = `status-badge ${isLive(g.statusText) ? "live" : ""}`;
        }
        card.classList.toggle("is-live", isLive(g.statusText));
        card.dataset.date = g.startyear;

        const meta = card.querySelector(".match-center");
        let ag = card.querySelector(".aggregate-text");
        if (g.aggregateText) {
          if (!ag) {
            ag = document.createElement("div");
            ag.className = "aggregate-text";
            meta.appendChild(ag);
          }
          ag.textContent = g.aggregateText;
        } else if (ag) ag.remove();
        let wd = card.querySelector(".win-description");
        if (g.winDescription) {
          if (!wd) {
            wd = document.createElement("div");
            wd.className = "win-description";
            meta.appendChild(wd);
          }
          wd.textContent = g.winDescription;
        } else if (wd) wd.remove();
      }

      /* â•â•â• RENDER ALL CARDS â•â•â• */
      function renderCards(games) {
        const container = document.getElementById("matchesContainer");
        const existing = new Map();
        container
          .querySelectorAll(".match-card")
          .forEach((c) => existing.set(c.dataset.id, c));

        games.forEach((g, idx) => {
          const ex = existing.get(g.id);
          if (ex) {
            updateCard(ex, g);
            existing.delete(g.id);
          } else container.appendChild(buildCard(g, currentTeamId, idx));
        });
        existing.forEach((c) => c.remove());
      }

      /* â•â•â• FILTER â•â•â• */
      function applyFilter() {
        const cards = document.querySelectorAll(".match-card");
        let visible = 0;

        cards.forEach((c) => {
          const show = showAll || c.dataset.date === selectedDate;
          c.classList.toggle("hidden", !show);
          if (show) visible++;
        });

        document.getElementById("filterLabel").textContent = showAll
          ? `Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (${cards.length})`
          : `Ù…Ø¨Ø§Ø±ÙŠØ§Øª ${formatDateAr(selectedDate)}`;

        const empty = document.getElementById("emptyState");
        const loading =
          document.getElementById("loadingState").style.display !== "none";
        empty.style.display = !loading && visible === 0 ? "block" : "none";
        document.getElementById("emptyMsg").textContent = showAll
          ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØ§Ø­Ø©"
          : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…";
      }

      function formatDateAr(ds) {
        return new Date(ds + "T12:00:00").toLocaleDateString("ar-SA", {
          weekday: "short",
          month: "short",
          day: "numeric",
        });
      }

      /* â•â•â• API â•â•â• */
      async function fetchMatches() {
        try {
          const teamid = getQueryParam("teamid");
          currentTeamId = teamid;
          const res = await fetch(
            `https://football-api.alameedtv.workers.dev/v1/son_format?teamid=${teamid}`,
          );
          const data = await res.json();

          document.getElementById("loadingState").style.display = "none";

          if (!data.games || data.games.length === 0) {
            document.getElementById("matchesContainer").innerHTML =
              '<div class="error-box">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚</div>';
            return;
          }

          allGames = data.games;

          // Initial render
          renderTeamHero(allGames, teamid);
          buildDateStrip();
          renderCards(allGames);
          applyFilter();
        } catch (e) {
          document.getElementById("loadingState").style.display = "none";
          document.getElementById("matchesContainer").innerHTML =
            '<div class="error-box">âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</div>';
        }
      }

      async function refreshMatches() {
        try {
          const teamid = getQueryParam("teamid");
          const res = await fetch(
            `https://football-api.alameedtv.workers.dev/v1/son_format?teamid=${teamid}`,
          );
          const data = await res.json();
          if (!data.games) return;
          allGames = data.games;
          buildDateStrip();
          renderCards(allGames);
          applyFilter();
        } catch {}
      }

      /* â•â•â• INIT â•â•â• */
      buildDateStrip(); // build empty strip immediately
      fetchMatches();
      setInterval(refreshMatches, 15000);
    </script>
  </body>
</html>

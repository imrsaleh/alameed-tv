<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-deep: #050810;
        --bg-surface: #0c1120;
        --bg-card: #111827;
        --bg-card-hover: #162036;
        --accent: #00e676;
        --accent-glow: #00e67633;
        --live: #ff3d57;
        --live-glow: #ff3d5733;
        --gold: #ffd54f;
        --text-primary: #f0f4ff;
        --text-secondary: #8899bb;
        --text-muted: #3a4f70;
        --border: #1a2840;
        --border-light: #263850;

        /* event colours */
        --col-goal: #00e676;
        --col-yellow: #ffd54f;
        --col-red: #ff3d57;
        --col-sub: #64b5f6;
        --col-miss: #ff8a65;
        --col-bar: #ce93d8;
        --col-default: #8899bb;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Tajawal", sans-serif;
        background: var(--bg-deep);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background:
          radial-gradient(
            ellipse 90% 55% at 50% -5%,
            #0a2040 0%,
            transparent 60%
          ),
          radial-gradient(
            ellipse 50% 40% at 85% 85%,
            #001830 0%,
            transparent 60%
          );
        pointer-events: none;
        z-index: 0;
      }

      /* â”€â”€ HEADER â”€â”€ */
      .header {
        position: sticky;
        top: 0;
        z-index: 200;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        height: 60px;
        background: rgba(5, 8, 16, 0.92);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
      }
      .logo {
        font-family: "Bebas Neue", sans-serif;
        font-size: 24px;
        letter-spacing: 3px;
        color: var(--accent);
        text-decoration: none;
        text-shadow: 0 0 24px var(--accent-glow);
      }
      .header-nav {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .header-nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
        padding: 6px 14px;
        border-radius: 8px;
        transition: all 0.2s;
      }
      .header-nav a:hover {
        color: var(--text-primary);
        background: var(--border);
      }
      .back-btn {
        display: flex;
        align-items: center;
        gap: 5px;
        border: 1px solid var(--border);
        border-radius: 8px;
        transition: border-color 0.2s;
      }
      .back-btn:hover {
        border-color: var(--border-light) !important;
      }

      /* â”€â”€ LOADING â”€â”€ */
      .loading-state {
        position: relative;
        z-index: 1;
        text-align: center;
        padding: 80px 20px;
      }
      .spinner {
        width: 44px;
        height: 44px;
        border: 3px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        margin: 0 auto 16px;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .loading-state p {
        color: var(--text-muted);
        font-size: 14px;
      }

      /* â”€â”€ MATCH HERO â”€â”€ */
      .match-hero {
        position: relative;
        z-index: 1;
        max-width: 820px;
        margin: 28px auto 0;
        padding: 0 16px;
        opacity: 0;
        animation: fadeUp 0.5s ease 0.1s forwards;
      }

      .competition-badge {
        text-align: center;
        margin-bottom: 16px;
      }
      .competition-badge span {
        display: inline-block;
        background: var(--bg-card);
        border: 1px solid var(--border);
        color: var(--text-secondary);
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.5px;
        padding: 5px 16px;
        border-radius: 20px;
      }
      .competition-badge .win-desc {
        display: inline-block;
        margin-right: 8px;
        color: var(--gold);
        font-size: 12px;
        font-weight: 600;
      }

      .hero-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 28px 24px 22px;
        position: relative;
        overflow: hidden;
      }
      .hero-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          ellipse 70% 60% at 50% 0%,
          rgba(0, 230, 118, 0.06),
          transparent 70%
        );
        pointer-events: none;
      }
      .hero-card.is-live::before {
        background: radial-gradient(
          ellipse 70% 60% at 50% 0%,
          rgba(255, 61, 87, 0.07),
          transparent 70%
        );
      }
      .hero-card.is-live {
        border-color: #ff3d5744;
        box-shadow:
          0 0 0 1px rgba(255, 61, 87, 0.1),
          0 16px 40px rgba(0, 0, 0, 0.5);
      }

      .teams-row {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        gap: 16px;
      }

      .team-block {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .team-block.home {
        align-items: flex-end;
        text-align: right;
      }
      .team-block.away {
        align-items: flex-start;
        text-align: left;
      }

      .team-logo-wrap {
        position: relative;
        display: inline-block;
      }
      .team-logo {
        width: 90px;
        height: 90px;
        object-fit: contain;
        border-radius: 50%;
        background: var(--bg-surface);
        padding: 6px;
        display: block;
      }
      .team-name-hero {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-primary);
        line-height: 1.2;
        max-width: 140px;
      }

      .score-block {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
      }
      .score-nums {
        font-family: "Bebas Neue", sans-serif;
        font-size: 52px;
        letter-spacing: 6px;
        color: var(--text-primary);
        line-height: 1;
      }
      .score-nums.not-started {
        font-size: 28px;
        color: var(--text-muted);
        letter-spacing: 3px;
      }
      .status-pill {
        font-size: 11px;
        font-weight: 700;
        padding: 3px 12px;
        border-radius: 20px;
        background: var(--bg-surface);
        color: var(--text-muted);
        border: 1px solid var(--border);
        white-space: nowrap;
      }
      .status-pill.live {
        background: var(--live-glow);
        color: var(--live);
        border-color: var(--live);
        animation: pulsePill 1.5s ease infinite;
      }
      @keyframes pulsePill {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(255, 61, 87, 0.4);
        }
        50% {
          box-shadow: 0 0 0 5px rgba(255, 61, 87, 0);
        }
      }
      .live-dot {
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--live);
        margin-left: 4px;
        vertical-align: middle;
        animation: dotPulse 1.2s ease infinite;
      }
      @keyframes dotPulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.4;
          transform: scale(0.7);
        }
      }
      .match-time-label {
        font-size: 11px;
        color: var(--text-muted);
        direction: ltr;
      }

      /* â”€â”€ TIMELINE SECTION â”€â”€ */
      .timeline-section {
        position: relative;
        z-index: 1;
        max-width: 820px;
        margin: 24px auto 60px;
        padding: 0 16px;
      }
      .timeline-section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
      }
      .timeline-section-title h2 {
        font-family: "Bebas Neue", sans-serif;
        font-size: 22px;
        letter-spacing: 2px;
        color: var(--text-secondary);
      }
      .timeline-section-title::before,
      .timeline-section-title::after {
        content: "";
        flex: 1;
        height: 1px;
        background: linear-gradient(to left, var(--border), transparent);
      }
      .timeline-section-title::after {
        background: linear-gradient(to right, var(--border), transparent);
      }

      /* â”€â”€ THE TIMELINE â”€â”€ */
      .timeline {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 0;
      }

      /* center line */
      .timeline::before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 1px;
        background: linear-gradient(
          to bottom,
          transparent,
          var(--border) 5%,
          var(--border) 95%,
          transparent
        );
      }

      /* â”€â”€ EVENT ROW â”€â”€ */
      .event-row {
        display: grid;
        grid-template-columns: 1fr 56px 1fr;
        align-items: center;
        min-height: 52px;
        padding: 5px 0;
        opacity: 0;
        animation: fadeUp 0.35s ease forwards;
      }

      .event-left {
        display: flex;
        justify-content: flex-end;
        padding-left: 14px;
      }
      .event-right {
        display: flex;
        justify-content: flex-start;
        padding-right: 14px;
      }

      /* center time bubble */
      .event-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 2px;
        position: relative;
        z-index: 2;
      }
      .time-bubble {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Bebas Neue", sans-serif;
        font-size: 15px;
        letter-spacing: 1px;
        background: var(--bg-card);
        border: 2px solid var(--border);
        color: var(--text-secondary);
        transition: all 0.2s;
      }
      /* event type colours on time bubble */
      .event-row.ev-goal .time-bubble {
        border-color: var(--col-goal);
        color: var(--col-goal);
        box-shadow: 0 0 10px rgba(0, 230, 118, 0.25);
      }
      .event-row.ev-yellow .time-bubble {
        border-color: var(--col-yellow);
        color: var(--col-yellow);
        box-shadow: 0 0 10px rgba(255, 213, 79, 0.2);
      }
      .event-row.ev-red .time-bubble {
        border-color: var(--col-red);
        color: var(--col-red);
        box-shadow: 0 0 10px rgba(255, 61, 87, 0.2);
      }
      .event-row.ev-sub .time-bubble {
        border-color: var(--col-sub);
        color: var(--col-sub);
      }
      .event-row.ev-miss .time-bubble {
        border-color: var(--col-miss);
        color: var(--col-miss);
      }
      .event-row.ev-bar .time-bubble {
        border-color: var(--col-bar);
        color: var(--col-bar);
      }

      /* â”€â”€ EVENT CARD â”€â”€ */
      .ev-card {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 9px 12px;
        max-width: 180px;
        width: 100%;
        transition: border-color 0.2s;
      }
      .ev-card:hover {
        border-color: var(--border-light);
      }

      /* home card aligns right, away card aligns left */
      .event-left .ev-card {
        flex-direction: row-reverse;
      }
      .event-right .ev-card {
        flex-direction: row;
      }

      .ev-icon-wrap {
        width: 28px;
        height: 28px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: var(--bg-surface);
      }
      .ev-icon-wrap img {
        width: 16px;
        height: 16px;
        object-fit: contain;
      }
      /* emoji fallback icon */
      .ev-icon-emoji {
        font-size: 14px;
        line-height: 1;
      }

      .ev-info {
        flex: 1;
        min-width: 0;
      }
      .ev-player {
        font-size: 13px;
        font-weight: 700;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: visible;
        text-overflow: ellipsis;
        line-height: 1.3;
      }
      .ev-sub-out {
        font-size: 11px;
        color: var(--text-muted);
        white-space: nowrap;
        overflow: visible;
        text-overflow: ellipsis;
      }
      .ev-sub-out::before {
        content: "â†“ ";
        color: var(--live);
      }
      .ev-type-label {
        font-size: 11px;
        font-weight: 600;
        margin-top: 1px;
      }

      /* colour coding text */
      .event-row.ev-goal .ev-type-label {
        color: var(--col-goal);
      }
      .event-row.ev-yellow .ev-type-label {
        color: var(--col-yellow);
      }
      .event-row.ev-red .ev-type-label {
        color: var(--col-red);
      }
      .event-row.ev-sub .ev-type-label {
        color: var(--col-sub);
      }
      .event-row.ev-miss .ev-type-label {
        color: var(--col-miss);
      }
      .event-row.ev-bar .ev-type-label {
        color: var(--col-bar);
      }

      /* left card text aligns right */
      .event-left .ev-info {
        text-align: right;
      }

      /* no-events */
      .no-events {
        text-align: center;
        padding: 48px 20px;
        color: var(--text-muted);
        font-size: 14px;
      }
      .no-events .ne-icon {
        font-size: 40px;
        margin-bottom: 12px;
      }

      /* error */
      .error-box {
        text-align: center;
        padding: 48px 20px;
        color: var(--live);
        font-size: 14px;
        position: relative;
        z-index: 1;
      }

      /* â”€â”€ ANIMATIONS â”€â”€ */
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* â”€â”€ RESPONSIVE â”€â”€ */
      @media (max-width: 520px) {
        .team-logo {
          width: 48px;
          height: 48px;
        }
        .score-nums {
          font-size: 40px;
          letter-spacing: 4px;
        }
        .team-name-hero {
          font-size: 13px;
        }
        .ev-card {
          padding: 7px 10px;
        }
        .ev-player {
          font-size: 12px;
        }
        .timeline::before {
          display: none;
        }
        .event-row {
          grid-template-columns: 1fr 48px 1fr;
        }
        .time-bubble {
          width: 36px;
          height: 36px;
          font-size: 13px;
        }
      }

      ::-webkit-scrollbar {
        width: 5px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <div class="header">
      <a class="logo">ALAMEED</a>
      <div class="header-nav">
        <a class="back-btn" href="index.html">&#8249; Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</a>
        <a href="./index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>
    </div>

    <!-- LOADING -->
    <div class="loading-state" id="loadingState">
      <div class="spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©...</p>
    </div>

    <!-- HERO (injected) -->
    <div id="heroContainer"></div>

    <!-- TIMELINE (injected) -->
    <div id="timelineContainer"></div>

    <script>
      /* â”€â”€ HELPERS â”€â”€ */
      function getQueryParam(p) {
        return new URLSearchParams(window.location.search).get(p);
      }

      function isLive(s) {
        return (
          s &&
          (s.includes("Ø´ÙˆØ·") ||
            // s.includes("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ") ||
            s.includes("Ø¨Ø¯Ù„Ø§Ø¡"))
        );
      }

      /* â”€â”€ EVENT CLASSIFICATION â”€â”€ */
      const EVENT_META = {
        Ù‡Ø¯Ù: {
          cls: "ev-goal",
          label: "Ù‡Ø¯Ù",
          emoji: "âš½",
          icon: "d1.svg/NewBrand25/EventSubType/dark/1",
        },
        "Ù‡Ø¯Ù Ø¹ÙƒØ³ÙŠ": {
          cls: "ev-goal",
          label: "Ù‡Ø¯Ù Ø¹ÙƒØ³ÙŠ",
          emoji: "âš½",
          icon: "1.svg/NewBrand25/EventSubType/dark/2",
        },
        "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØºÙŠ": {
          cls: "ev-miss",
          label: "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØºÙŠ",
          emoji: "ğŸš«",
          icon: "11.svg/NewBrand25/EventSubType/dark/25",
        },
        "Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡": {
          cls: "ev-goal",
          label: "Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡ â€” Ù‡Ø¯Ù",
          emoji: "âš½",
          icon: "1.svg/NewBrand25/EventSubType/dark/3",
        },
        "Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡ Ø¶Ø§Ø¦Ø¹Ø©": {
          cls: "ev-miss",
          label: "Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡ Ø¶Ø§Ø¦Ø¹Ø©",
          emoji: "âŒ",
          icon: "6.svg/NewBrand25/EventType/dark/6",
        },
        "Ø¨Ø·Ø§Ù‚Ø© ØµÙØ±Ø§Ø¡": {
          cls: "ev-yellow",
          label: "Ø¨Ø·Ø§Ù‚Ø© ØµÙØ±Ø§Ø¡",
          emoji: "ğŸŸ¨",
          icon: "2.svg/NewBrand25/EventType/dark/2",
        },
        "Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©": {
          cls: "ev-red",
          label: "Ø¨Ø·Ø§Ù‚Ø© Ø­Ù…Ø±Ø§Ø¡ Ø«Ø§Ù†ÙŠØ©",
          emoji: "ğŸŸ¥",
          icon: "3.svg/NewBrand25/EventSubType/dark/21",
        },
        "Ø¨Ø·Ø§Ù‚Ø© Ø­Ù…Ø±Ø§Ø¡": {
          cls: "ev-red",
          label: "Ø¨Ø·Ø§Ù‚Ø© Ø­Ù…Ø±Ø§Ø¡",
          emoji: "ğŸŸ¥",
          icon: "3.svg/NewBrand25/EventType/dark/3",
        },
        "ØªØ³Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©": {
          cls: "ev-bar",
          label: "ØªØ³Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©",
          emoji: "ğŸ—ï¸",
          icon: "12.svg/NewBrand25/EventType/dark/12",
        },
        Ø§Ø³ØªØ¨Ø¯Ø§Ù„: {
          cls: "ev-sub",
          label: "ØªØ¨Ø¯ÙŠÙ„",
          emoji: "ğŸ”„",
          icon: "1000.svg/NewBrand25/EventType/dark/1000",
        },
      };

      function classifyEvent(text) {
        if (text.includes("Ù‡Ø¯Ù Ø¹ÙƒØ³ÙŠ")) return "Ù‡Ø¯Ù Ø¹ÙƒØ³ÙŠ";
        if (text.includes("Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØºÙŠ")) return "Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØºÙŠ";
        if (text.includes("Ù‡Ø¯Ù Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡")) return "Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡";
        if (text.includes("Ø¥Ø¶Ø§Ø¹Ø© Ø§Ù„Ø¶Ù‘Ø±Ø¨Ø§Øª Ø§Ù„Ø¬Ù‘Ø²Ø§Ø¦ÙŠÙ‘Ø©"))
          return "Ø±ÙƒÙ„Ø© Ø¬Ø²Ø§Ø¡ Ø¶Ø§Ø¦Ø¹Ø©";
        if (text.includes("Ù‡Ø¯Ù")) return "Ù‡Ø¯Ù";
        if (text.includes("Ø¨Ø·Ø§Ù‚Ø© ØµÙØ±Ø§Ø¡")) return "Ø¨Ø·Ø§Ù‚Ø© ØµÙØ±Ø§Ø¡";
        if (text.includes("Ø¨Ø·Ø§Ù‚ØªÙŠÙ†")) return "Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©";
        if (text.includes("Ø¨Ø·Ø§Ù‚Ø© Ø­Ù…Ø±Ø§Ø¡")) return "Ø¨Ø·Ø§Ù‚Ø© Ø­Ù…Ø±Ø§Ø¡";
        if (text.includes("ØªØ³Ø¯ÙŠØ¯Ø©")) return "ØªØ³Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©";
        if (text.includes("ØªØ¨Ø¯ÙŠÙ„")) return "Ø§Ø³ØªØ¨Ø¯Ø§Ù„";
        return null;
      }

      function iconUrl(path) {
        const base =
          "https://imagecache.365scores.com/image/upload/f_svg,w_16,h_16,c_limit,q_auto:eco,dpr_1,d_NewBrand25:EventTypes:dark:";
        return base + path;
      }

      /* â”€â”€ GAME STATE â”€â”€ */
      let game;
      let heroBuilt = false; // true after first full hero render
      let timelineBuilt = false; // true after first full timeline render

      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HERO  â€”  build once, patch on refresh
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

      function buildHero(g) {
        /* Creates the full static DOM structure once.
           Dynamic parts get stable IDs so updateHero() can patch them. */
        const live = isLive(g.statusText);
        const gt = g.gameTime ? ` ${g.gameTime}'` : "";

        const heroContainer = document.getElementById("heroContainer");

        // â”€â”€ wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const matchHero = document.createElement("div");
        matchHero.className = "match-hero";

        // â”€â”€ competition badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const badge = document.createElement("div");
        badge.className = "competition-badge";

        const compSpan = document.createElement("span");
        compSpan.id = "heroCompName";
        compSpan.textContent = g.competitionDisplayName;
        badge.appendChild(compSpan);

        const winDescSpan = document.createElement("span");
        winDescSpan.className = "win-desc";
        winDescSpan.id = "heroWinDesc";
        if (g.winDescription) winDescSpan.textContent = `(${g.winDescription})`;
        badge.appendChild(winDescSpan);

        const aggSpan = document.createElement("span");
        aggSpan.id = "heroAgg";
        aggSpan.style.cssText =
          "margin-right:6px;font-size:11px;color:var(--gold)";
        if (g.aggregateText) aggSpan.textContent = g.aggregateText;
        badge.appendChild(aggSpan);

        matchHero.appendChild(badge);

        // â”€â”€ hero card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const heroCard = document.createElement("div");
        heroCard.className = "hero-card" + (live ? " is-live" : "");
        heroCard.id = "heroCard";

        // teams row
        const teamsRow = document.createElement("div");
        teamsRow.className = "teams-row";

        // home
        const homeBlock = document.createElement("div");
        homeBlock.className = "team-block home";
        const homeLogo = document.createElement("img");
        homeLogo.className = "team-logo";
        homeLogo.src = g.first_team_logo;
        homeLogo.alt = g.first_team;
        homeLogo.onerror = function () {
          this.style.visibility = "hidden";
        };
        const homeName = document.createElement("div");
        homeName.className = "team-name-hero";
        homeName.textContent = g.first_team;
        homeBlock.appendChild(homeLogo);
        homeBlock.appendChild(homeName);

        // score block
        const scoreBlock = document.createElement("div");
        scoreBlock.className = "score-block";

        const scoreEl = document.createElement("div");
        scoreEl.id = "heroScore";
        if (g.statusText === "Ù„Ù… ØªØ¨Ø¯Ø£") {
          scoreEl.className = "score-nums not-started";
          scoreEl.textContent = "VS";
        } else {
          scoreEl.className = "score-nums";
          scoreEl.textContent = `${g.first_team_score} - ${g.second_team_score}`;
        }

        const statusPill = document.createElement("span");
        statusPill.id = "heroStatus";
        statusPill.className = "status-pill" + (live ? " live" : "");
        if (live) {
          const dot = document.createElement("span");
          dot.className = "live-dot";
          statusPill.appendChild(dot);
        }
        statusPill.appendChild(document.createTextNode(`${g.statusText}${gt}`));

        const timeLabel = document.createElement("span");
        timeLabel.className = "match-time-label";
        timeLabel.textContent = `${g.startTime} â€¢ ${g.startyear}`;

        scoreBlock.appendChild(scoreEl);
        scoreBlock.appendChild(statusPill);
        scoreBlock.appendChild(timeLabel);

        // away
        const awayBlock = document.createElement("div");
        awayBlock.className = "team-block away";
        const awayLogo = document.createElement("img");
        awayLogo.className = "team-logo";
        awayLogo.src = g.second_team_logo;
        awayLogo.alt = g.second_team;
        awayLogo.onerror = function () {
          this.style.visibility = "hidden";
        };
        const awayName = document.createElement("div");
        awayName.className = "team-name-hero";
        awayName.textContent = g.second_team;
        awayBlock.appendChild(awayLogo);
        awayBlock.appendChild(awayName);

        teamsRow.appendChild(homeBlock);
        teamsRow.appendChild(scoreBlock);
        teamsRow.appendChild(awayBlock);
        heroCard.appendChild(teamsRow);
        matchHero.appendChild(heroCard);
        heroContainer.appendChild(matchHero);

        heroBuilt = true;
      }

      function updateHero(g) {
        /* Patches only the values that can change during a live match.
           Never touches <img> src â€” images never reload. */
        const live = isLive(g.statusText);
        const gt = g.gameTime ? ` ${g.gameTime}'` : "";

        // â”€â”€ score â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const scoreEl = document.getElementById("heroScore");
        if (scoreEl) {
          if (g.statusText === "Ù„Ù… ØªØ¨Ø¯Ø£") {
            if (scoreEl.className !== "score-nums not-started")
              scoreEl.className = "score-nums not-started";
            if (scoreEl.textContent !== "VS") scoreEl.textContent = "VS";
          } else {
            const ns = `${g.first_team_score} - ${g.second_team_score}`;
            if (scoreEl.className !== "score-nums")
              scoreEl.className = "score-nums";
            if (scoreEl.textContent !== ns) scoreEl.textContent = ns;
          }
        }

        // â”€â”€ status pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const pill = document.getElementById("heroStatus");
        if (pill) {
          const wantLive = live;
          const pillIsLive = pill.classList.contains("live");

          if (wantLive !== pillIsLive) pill.classList.toggle("live", wantLive);

          // sync live-dot node
          const existingDot = pill.querySelector(".live-dot");
          if (wantLive && !existingDot) {
            const dot = document.createElement("span");
            dot.className = "live-dot";
            pill.insertBefore(dot, pill.firstChild);
          } else if (!wantLive && existingDot) {
            existingDot.remove();
          }

          // sync text node
          const wantText = `${g.statusText}${gt}`;
          let textNode = null;
          for (let i = pill.childNodes.length - 1; i >= 0; i--) {
            if (pill.childNodes[i].nodeType === Node.TEXT_NODE) {
              textNode = pill.childNodes[i];
              break;
            }
          }
          if (!textNode) {
            pill.appendChild(document.createTextNode(wantText));
          } else if (textNode.nodeValue !== wantText) {
            textNode.nodeValue = wantText;
          }
        }

        // â”€â”€ hero card live border â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const card = document.getElementById("heroCard");
        if (card) {
          const cardIsLive = card.classList.contains("is-live");
          if (live !== cardIsLive) card.classList.toggle("is-live", live);
        }

        // â”€â”€ win description â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const winEl = document.getElementById("heroWinDesc");
        if (winEl) {
          const want = g.winDescription ? `(${g.winDescription})` : "";
          if (winEl.textContent !== want) winEl.textContent = want;
        }

        // â”€â”€ aggregate text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const aggEl = document.getElementById("heroAgg");
        if (aggEl) {
          const want = g.aggregateText || "";
          if (aggEl.textContent !== want) aggEl.textContent = want;
        }
      }

      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TIMELINE  â€”  build skeleton once, diff events on refresh
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

      // Stable key for deduplication: teamID + eventTime + event type
      function eventKey(ev) {
        return `${ev.teamID}|${ev.eventTime}|${ev.event}`;
      }

      function buildEventRow(ev, g, animate) {
        /* Creates a single event-row DOM node.
           animate=false skips the fadeUp animation (used on refresh). */
        const type = classifyEvent(ev.event);
        const meta = EVENT_META[type] || {
          cls: "",
          label: ev.event,
          emoji: "â€¢",
          icon: "",
        };
        const isHome = ev.teamID === game.first_team_id;

        // â”€â”€ icon â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const iconWrap = document.createElement("div");
        iconWrap.className = "ev-icon-wrap";
        if (meta.icon) {
          const img = document.createElement("img");
          img.src = iconUrl(meta.icon);
          img.alt = meta.label;
          img.onerror = function () {
            this.style.display = "none";
          };
          iconWrap.appendChild(img);
        } else {
          const emoji = document.createElement("span");
          emoji.className = "ev-icon-emoji";
          emoji.textContent = meta.emoji;
          iconWrap.appendChild(emoji);
        }

        // â”€â”€ player info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const evInfo = document.createElement("div");
        evInfo.className = "ev-info";

        const playerEl = document.createElement("div");
        playerEl.className = "ev-player";
        playerEl.textContent =
          type === "Ø§Ø³ØªØ¨Ø¯Ø§Ù„" ? ev.playerIN || ev.player || "" : ev.player || "";
        evInfo.appendChild(playerEl);

        if (type === "Ø§Ø³ØªØ¨Ø¯Ø§Ù„" && ev.playerOUT) {
          const subOut = document.createElement("div");
          subOut.className = "ev-sub-out";
          subOut.textContent = ev.playerOUT;
          evInfo.appendChild(subOut);
        }

        const typeLabel = document.createElement("div");
        typeLabel.className = "ev-type-label";
        typeLabel.textContent = meta.label || "";
        evInfo.appendChild(typeLabel);

        // â”€â”€ card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const evCard = document.createElement("div");
        evCard.className = "ev-card";
        evCard.appendChild(iconWrap);
        evCard.appendChild(evInfo);

        // â”€â”€ left / center / right cells â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const leftCell = document.createElement("div");
        leftCell.className = "event-left";
        const centerCell = document.createElement("div");
        centerCell.className = "event-center";
        const rightCell = document.createElement("div");
        rightCell.className = "event-right";

        const bubble = document.createElement("div");
        bubble.className = "time-bubble";
        bubble.textContent = `${ev.eventTime}'`;
        centerCell.appendChild(bubble);

        if (isHome) leftCell.appendChild(evCard);
        else rightCell.appendChild(evCard);

        // â”€â”€ row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const row = document.createElement("div");
        row.className = "event-row" + (meta.cls ? " " + meta.cls : "");
        row.dataset.key = eventKey(ev);

        if (!animate) {
          // already visible â€” no animation replay
          row.style.opacity = "1";
          row.style.animation = "none";
        }

        row.appendChild(leftCell);
        row.appendChild(centerCell);
        row.appendChild(rightCell);
        return row;
      }

      function buildTimelineShell(g) {
        /* Creates the static chrome: section wrapper, title, column headers, timeline div.
           Called once. The .timeline div is the only thing that gets diffed later. */
        const container = document.getElementById("timelineContainer");
        container.innerHTML = ""; // only ever called once

        const section = document.createElement("div");
        section.className = "timeline-section";

        const titleDiv = document.createElement("div");
        titleDiv.className = "timeline-section-title";
        const h2 = document.createElement("h2");
        h2.textContent = "Ù…Ø¬Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©";
        titleDiv.appendChild(h2);
        section.appendChild(titleDiv);

        // column headers
        const colHeaders = document.createElement("div");
        colHeaders.style.cssText =
          "display:grid;grid-template-columns:1fr 56px 1fr;margin-bottom:10px;padding:0 4px";
        const homeHeader = document.createElement("div");
        homeHeader.id = "tlHomeLabel";
        homeHeader.style.cssText =
          "text-align:right;font-size:11px;font-weight:700;color:var(--text-muted);letter-spacing:.5px;padding-left:14px";
        homeHeader.textContent = g.first_team;
        const mid = document.createElement("div");
        const awayHeader = document.createElement("div");
        awayHeader.id = "tlAwayLabel";
        awayHeader.style.cssText =
          "text-align:left;font-size:11px;font-weight:700;color:var(--text-muted);letter-spacing:.5px;padding-right:14px";
        awayHeader.textContent = g.second_team;
        colHeaders.appendChild(homeHeader);
        colHeaders.appendChild(mid);
        colHeaders.appendChild(awayHeader);
        section.appendChild(colHeaders);

        const timeline = document.createElement("div");
        timeline.className = "timeline";
        timeline.id = "timelineTrack";
        section.appendChild(timeline);

        container.appendChild(section);
        timelineBuilt = true;
      }

      function showNoEvents(g) {
        /* Replaces timeline content with the "no events" placeholder.
           Only used when there are genuinely no events. */
        const container = document.getElementById("timelineContainer");
        const existing = container.querySelector(".no-events");

        const msg =
          g.statusText === "Ù„Ù… ØªØ¨Ø¯Ø£"
            ? "Ù„Ù… ØªØ¨Ø¯Ø£ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¨Ø¹Ø¯"
            : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ù…ØªØ§Ø­Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†";

        if (existing) {
          // update message in-place, no flicker
          const p = existing.querySelector("p");
          if (p && p.textContent !== msg) p.textContent = msg;
          return;
        }

        container.innerHTML = `
          <div class="timeline-section">
            <div class="no-events">
              <div class="ne-icon">ğŸŸï¸</div>
              <p>${msg}</p>
            </div>
          </div>`;
        timelineBuilt = false; // shell needs rebuild if events arrive later
      }

      function patchTimeline(g, events) {
        /* Diffs the event list against existing DOM rows.
           - Existing rows: kept in-place, no animation replay, no image reload
           - New rows: appended with animation
           - Removed rows: deleted
           Order: newest-first (re-sorted each call, rows are moved not recreated) */

        const valid = (events || []).filter(
          (e) => e.event !== null && e.eventTime !== null && e.teamID !== null,
        );

        // â”€â”€ no events edge-case â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (valid.length === 0) {
          if (timelineBuilt) {
            // clear the track but keep the shell
            const track = document.getElementById("timelineTrack");
            if (track) track.innerHTML = "";
          }
          showNoEvents(g);
          return;
        }

        // â”€â”€ ensure shell exists â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (!timelineBuilt || !document.getElementById("timelineTrack")) {
          // Remove any no-events placeholder first
          const container = document.getElementById("timelineContainer");
          container.innerHTML = "";
          timelineBuilt = false;
          buildTimelineShell(g);
        }

        const track = document.getElementById("timelineTrack");

        // Sort newest-first
        const sorted = [...valid].sort((a, b) => {
          return (parseInt(b.eventTime) || 0) - (parseInt(a.eventTime) || 0);
        });

        // â”€â”€ build key â†’ existing row map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const existingRows = new Map();
        track.querySelectorAll(".event-row").forEach((row) => {
          existingRows.set(row.dataset.key, row);
        });

        // â”€â”€ desired key set â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const desiredKeys = new Set(sorted.map(eventKey));

        // â”€â”€ remove rows no longer in data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        existingRows.forEach((row, key) => {
          if (!desiredKeys.has(key)) {
            row.remove();
            existingRows.delete(key);
          }
        });

        // â”€â”€ insert / reorder rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        sorted.forEach((ev, idx) => {
          const key = eventKey(ev);
          let row = existingRows.get(key);

          if (!row) {
            // Brand-new event â€” build with animation, stagger slightly
            row = buildEventRow(ev, g, true);
            row.style.animationDelay = idx * 35 + "ms";
          } else {
            // Existing row â€” ensure no animation re-triggers
            if (row.style.animation !== "none") {
              row.style.animation = "none";
              row.style.opacity = "1";
            }
          }

          // Maintain correct order by inserting at the right position
          const refNode = track.children[idx];
          if (refNode !== row) {
            track.insertBefore(row, refNode || null);
          }
        });
      }

      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FETCH
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      async function fetchGame() {
        try {
          const gameid = getQueryParam("gameid");
          const res = await fetch(
            `https://football-api.alameedtv.workers.dev/v1/json_format/gameinfo?gameid=${gameid}`,
          );
          const data = await res.json();

          document.getElementById("loadingState").style.display = "none";

          if (!data.games || data.games.length === 0) {
            document.getElementById("heroContainer").innerHTML =
              '<div class="error-box">âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>';
            return;
          }

          game = data.games[0];
          const events = data.events || [];

          // First load â€” build full structure from scratch
          if (!heroBuilt) {
            buildHero(game);
          } else {
            updateHero(game);
          }

          patchTimeline(game, events);

          document.title = `${game.first_team} vs ${game.second_team}`;
        } catch (err) {
          document.getElementById("loadingState").style.display = "none";
          document.getElementById("heroContainer").innerHTML =
            '<div class="error-box">âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
        }
      }

      /* â”€â”€ LIVE REFRESH â”€â”€ */
      function refreshLive() {
        if (
          !game ||
          game.statusText.includes("Ø§Ù†ØªÙ‡Øª") ||
          game.statusText.includes("Ù„Ù… ØªØ¨Ø¯Ø£") ||
          game.statusText.includes("Ø¨Ø¹Ø¯ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ")
        )
          return;
        fetchGame();
      }

      fetchGame();
      setInterval(refreshLive, 20000);
    </script>
  </body>
</html>
